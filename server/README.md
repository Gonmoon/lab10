# Belpost Subscriptions API

## Установка и запуск

```bash
cd server
npm install
cp .env.example .env
# При необходимости отредактируйте MONGO_URI и PORT
npm run seed
npm run dev
```

## Основные сущности

- **Edition** — издание (газета/журнал)
- **Recipient** — получатель
- **Subscription** — подписка (связь получателя и издания)

## Основные эндпоинты

### Издания `/api/editions`

- `POST /api/editions` — создать издание  
- `GET /api/editions` — список изданий с поддержкой:
  - пагинации: `page`, `limit`
  - сортировки: `sort` (например, `sort=title,-monthlyPrice`)
  - фильтрации по полям (`type=газета`)
  - поиска `search` (по полям `title`, `index`, `type`)
- `GET /api/editions/:id` — детальная информация
- `PUT /api/editions/:id` — обновление
- `DELETE /api/editions/:id` — удаление
- `GET /api/editions/:id/exists` — проверка существования

### Получатели `/api/recipients`

Аналогично: CRUD, список с пагинацией/поиском/фильтрацией, проверка существования.

Особенность: при наличии подписок удалить получателя нельзя (вернётся статус `409`).

### Подписки `/api/subscriptions`

CRUD, список с пагинацией, фильтрацией по полям `months`, `startYear`, `startMonth`, проверка существования.

## Тестовые сценарии для Postman (пример)

1. **Создание издания (успех)**  
   - POST `/api/editions`  
   - Тело: валидные данные  
   - Ожидаемый статус: `201`.

2. **Создание издания (ошибка валидации)**  
   - POST `/api/editions`  
   - Тело: без `index` или с неверным индексом  
   - Ожидаемый статус: `400`, ответ содержит `errors`.

3. **Получение списка изданий с пагинацией**  
   - GET `/api/editions?page=1&limit=5`  
   - Ожидаемый статус: `200`, поле `meta` с количеством страниц.

4. **Поиск изданий**  
   - GET `/api/editions?search=Белоруссия`  
   - Ожидаемый статус: `200`, в списке присутствуют подходящие записи.

5. **Сортировка изданий**  
   - GET `/api/editions?sort=-monthlyPrice`  
   - Ожидаемый результат: упорядоченный список по убыванию цены.

6. **Детальный просмотр издания**  
   - GET `/api/editions/:id`  
   - Ожидаемый статус: `200` при существующем ID, `404` — при несуществующем.

7. **Обновление издания**  
   - PUT `/api/editions/:id`  
   - Тело: изменение, например, `monthlyPrice`  
   - Ожидаемый статус: `200`, цена изменена.

8. **Удаление издания**  
   - DELETE `/api/editions/:id`  
   - Ожидаемый статус: `200`.  
   - Повторный `GET` по тому же ID → `404`.

9. **Создание получателя и подписки**  
   - POST `/api/recipients`  
   - POST `/api/subscriptions` (с валидными ссылками на `recipient` и `edition`)  
   - Ожидаемый результат: оба объекта созданы.

10. **Попытка удалить получателя с подпиской**  
    - DELETE `/api/recipients/:id`  
    - Ожидаемый статус: `409`, сообщение о невозможности удаления.
